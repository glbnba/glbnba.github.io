掌握ARM芯片时钟体系
System On Chip (Soc)
在Soc上不仅仅有CPU，还有各种外设。
 
2、时钟管理
 
从该图可以看出，时钟源有两个，一个是晶振OSC，一个是EXTCLK，这两者究竟使用哪一个呢？
它会通过OM[3:2]选择器进行选择，选择器是如何进行选择呢？
 
从这个表格中可以看出，时钟源的选择取决于OM[3:2]这两个引脚的值。这两个引脚的值是在哪里确定的，看一下原理图。在原理图中搜OM[3:2]
 
从图中可以看出OM[3:2]这两个引脚接地，因此使用的时钟源是晶振OSC。
时钟源是12MHZ的晶振，如何得到400MHZ的频率呢？中间肯定有一些硬件单元来做这件事情，使用什么样的硬件单元呢？
使用锁相环PLL。
晶振时钟12MHZ进来，调节MPLL中的P、M、S三个参数来控制输出更高的频率。
晶振时钟12MHZ进来，调节UPLL中的P、M、S三个参数来控制输出更高的频率。
MPLL： Main PLL
UPLL:   USB PLL
总结如下：
 
3、如何编程
控制MPLL、HDIV、PDIV
 
1）从该图可以看出，一上电，复位引脚并没有立刻被拉高，而是维持了一段时间才被拉高，为什么会这样呢？
首先要明白这个复位引脚是由复位芯片控制的，复位芯片等电源稳定之后，才输出高电平，从而将复位引脚拉高。
2）一上电，FCLK就等于晶振的12MHZ了，但此时CPU还没有运行，直至复位引脚变为高电平时，CPU才运行。
3）设置PLL的值。在设置PLL期间，FCLK是不起振的，CPU停止运行，等Lock Time结束，FCLK就等于PLL输出的新的时钟频率，此后CPU才开始运行。
第2节 编程提高运行时钟
编程：
 
1）设置MPLLCON，使得FCLK=400M

 


 
从该表中可以看出，要想使得FCLK=400MHZ，MDIV=92，PDIV=1，SDIV=1。
可以利用下面这个公式验证一下，FCLK是否等于400MHZ。
 
m=MDIV+8 =92+8=100;
p=PDIV+2=1+2=3
s=1
因此MPLL=2*100*12M/(3*2)=400M
 
因此需要设置MPLLCON=(92<<12)|(1<<4)|(1<<0)

 
在这里我们使得HCLK=FCLK/4,需要设置HDIVN[2:1]=0b10,前提条件是CAMDIVN[9]=0,实际上CAMDIVN[9]默认就是0。
使得PCLK=FCLK/8=HCLK/2，需要设置PDIVN[0]=0。
 
在编程之前，还需要注意这点。HDIV不等于0，所以CPU总线模式是快速模式，CPU的时钟频率是由HCLK提供的。你要想让它工作在FCLK=400MHZ的频率下，必须将CPU的工作模式设为异步工作模式。

